#!/bin/bash

#-----------
# VARIABLES
#-----------

MARKETPLACE_PARTNERS_BRANCH=${MARKETPLACE_PARTNERS_BRANCH-master}

#-----------
# INSTALLER
#-----------

[ "`which bits 2> /dev/null`" == "" ] && bash <(curl -s https://raw.githubusercontent.com/capbash/bits/master/bits-installer)

bits install-if openssh-server

rm -rf /etc/src/marketplace-partners && \
  rm -f /usr/local/bin/marketplace_* && \
  mkdir -p /etc/src && \
  (cd /etc/src && \
    git clone https://github.com/digitalocean/marketplace-partners.git && \
    cd marketplace-partners && \
    git checkout $MARKETPLACE_PARTNERS_BRANCH) && \
  ln -s /etc/src/marketplace-partners/scripts/cleanup.sh /usr/local/bin/marketplace_cleanup && \
  ln -s /etc/src/marketplace-partners/scripts/img_check.sh /usr/local/bin/marketplace_img_checks && \
  chmod 755 /usr/local/bin/marketplace_*